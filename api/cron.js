// Анекдоты про Башмачка
const jokes = [
  "Башмачок обнаружил на кухне мышь. Долго сидел, наблюдал, но не поймал. Когда его спросили, почему не охотится, ответил важно: «Я кот дворянского происхождения. Мыши — занятие для простолюдинов».",
  "Пришел как-то гость в дом и попытался взять Башмачка на руки. Кот посмотрел на него холодно и удалился в другую комнату. «Что же он такой гордый?» — спросил гость. «Башмачок принимает только по записи», — объяснили ему.",
  "Башмачку поставили миску с дешевым кормом. Кот обнюхал, презрительно фыркнул и ушел голодным. «Может, добавить что-то повкуснее?» — посоветовали хозяину. «Нет, — ответил Башмачок, возвращаясь через час. — Пусть научатся готовить правильно. Я подожду».",
  "Ветеринар осматривал Башмачка и сказал: «Прекрасное здоровье, отличная порода». Кот поднял голову и важно промурлыкал. «Он всегда так себя ведет?» — спросил врач. «Только когда его хвалят», — ответили ему. «Тогда он должен так себя вести постоянно».",
  "Башмачок лежал на самом дорогом кресле в доме. Когда попытались его согнать, не пошевелился. «Может, силой?» — предложил один. «Не советую, — сказал другой. — Последний, кто попробовал, до сих пор лечит царапины». Башмачок продолжал лежать.",
  "Принесли Башмачку новую игрушку — дорогую, с перьями. Кот посмотрел на нее равнодушно и пошел играть с обычной скомканной бумагой. «Зачем же мы тратили деньги?» — возмутились хозяева. Башмачок не ответил. Он был занят важным государственным делом — бумагой.",
  "Башмачок сидел у окна и наблюдал за голубями на карнизе. «Что, хочешь поймать?» — спросили его. Кот медленно повернул голову: «Когда русский кот смотрит в окно, он не охотится. Он размышляет о судьбах империи».",
  "Как-то Башмачок застрял в узком проходе между мебелью. Пришлось двигать шкаф, чтобы его освободить. «Ну и зачем ты туда полез?» — спросили кота. Башмачок гордо удалился, не удостоив ответом. Начальству объяснений не дают."
];

export default async function handler(req, res) {
  // 1. Проверка безопасности (чтобы никто другой не дергал вашу ссылку)
  // Vercel автоматически добавляет этот заголовок при запуске Cron
  const authHeader = req.headers.get('authorization');
  if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
    // Для локальных тестов можно закомментировать эти три строки ниже
    // return res.status(401).json({ success: false });
  }

  // 2. Выбираем случайный анекдот
  const randomJoke = jokes[Math.floor(Math.random() * jokes.length)];

  // 3. Отправляем в Telegram
  const token = process.env.TELEGRAM_TOKEN;
  const chatId = process.env.TELEGRAM_CHAT_ID;
  
  const url = `https://api.telegram.org/bot${token}/sendMessage`;

  try {
    await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: chatId,
        text: randomJoke,
        link_preview_options: { is_disabled: true }
      })
    });

    return res.status(200).json({ success: true, message: "Message sent!" });
  } catch (error) {
    return res.status(500).json({ success: false, error: error.message });
  }
}

export const config = {
  runtime: 'edge', // Делает запуск быстрее и дешевле
};